---
import type { ExtinctionCardProps } from "./cards/ExtinctionCard.astro";
import ExtinctionCard from "./cards/ExtinctionCard.astro";

const cards: ExtinctionCardProps[] = [
  {
    title: "Impacto de asteroide",
    list: [
      "Un asteroide de unos 10 km de diámetro chocó en la actual Península de Yucatán (México).",
      "El cráter resultante, llamado Chicxulub, tiene más de 180 km de ancho.",
      "Liberó una energía equivalente a millones de bombas nucleares.",
    ],
    image: "/extinction-slide-1.webp",
    icon: "fa-meteor",
  },
  {
    title: "Actividad volcánica masiva",
    list: [
      "Las erupciones en la región del Decán (India) liberaron gases tóxicos a la atmósfera.",
      "Esto contribuyó a un cambio climático extremo, con enfriamientos y lluvias ácidas.",
    ],
    image: "/extinction-slide-2.webp",
    icon: "fa-volcano",
  },
  {
    title: "Efectos globales",
    list: [
      "Oscurecimiento del cielo: ceniza y polvo bloquearon la luz solar.",
      "Colapso de las cadenas alimenticias: plantas murieron, y con ellas los herbívoros y luego los carnívoros.",
      "Cambios en la atmósfera: aumento de gases como el dióxido de azufre y el CO₂.",
    ],
    image: "/extinction-slide-3.webp",
    icon: "fa-cloud",
  },
];
---

<section class="extinction">
  <div class="extinction__cont">
    <h2 class="extinction__title">La extinción de los dinosaurios</h2>
    <p class="extinction__desc">
      Hace unos <span>66 millones de años</span>, al final del periodo
      Cretácico, ocurrió uno de los eventos más catastróficos en la historia de
      la Tierra: <span>una extinción masiva</span> que acabó con el 75% de todas
      las especies vivas, incluidos los dinosaurios no avianos.
    </p>
    <h3 class="extinction__subtitle">¿Qué causó la extinción?</h3>
    <div class="extinction__main">
      <div class="extinction__grid__cont">
        <div class="extinction__grid">
          {
            cards.map((card) => (
              <ExtinctionCard
                title={card.title}
                list={card.list}
                image={card.image}
                icon={card.icon}
              />
            ))
          }
        </div>
      </div>
      <div class="extinction__grid__prev">
        <i class="fa-solid fa-angle-left"></i>
      </div>
      <div class="extinction__grid__next">
        <i class="fa-solid fa-angle-right"></i>
      </div>
      <div class="extinction__grid__dots">
        <div class="extinction__grid__dot extinction__grid__dot--active"></div>
        <div class="extinction__grid__dot"></div>
        <div class="extinction__grid__dot"></div>
      </div>
    </div>
    <footer class="extinction__footer">
      <div class="extinction__footer__text">
        <h2 class="extinction__footer__title">
          ¿Todos los dinosaurios murieron?
        </h2>
        <div class="extinction__footer__img">
          <img
            src="/aves.webp"
            alt="ave roja"
          />
        </div>
        <p class="extinction__footer__desc">
          No todos los dinosaurios se extinguieron. Los <span
            >dinosaurios avianos</span
          >, como las aves modernas, sobrevivieron y evolucionaron a partir de
          algunos grupos de dinosaurios terópodos. Así que, en cierto sentido,
          ¡los dinosaurios aún están entre nosotros!
        </p>
      </div>
      <div class="extinction__footer__img__desktop">
        <img
          src="/aves.webp"
          alt="ave roja"
        />
      </div>
    </footer>
  </div>
</section>

<style>
  .extinction {
    padding: 5rem 0;
    background: linear-gradient(var(--secondary-dark), var(--secondary-hover));
    color: var(--white);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    .extinction__cont {
      margin: 0 auto;
      text-align: center;
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
      .extinction__title {
        font-size: 2.4rem;
        margin-bottom: 1rem;
        &:after {
          content: "";
          display: block;
          width: 100px;
          height: 4px;
          background-color: var(--light-black);
          margin: 0.5rem auto;
          border-radius: 2px;
        }
      }
      .extinction__subtitle {
        font-size: 1.6rem;
        color: var(--white);
        margin-bottom: 1rem;
      }
      .extinction__desc {
        font-size: 1.1rem;
        color: var(--white);
        margin-bottom: 2rem;
        max-width: 60ch;
        span {
          color: var(--white);
          font-weight: 600;
        }
      }
      .extinction__grid {
        display: flex;
        gap: 2rem;
        align-items: center;
        transition: all 0.3s ease;
        will-change: transform;
      }
      .extinction__grid__cont {
        width: 100%;
        max-width: 1200px;
        overflow: hidden;
      }
      .extinction__grid__dots {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        .extinction__grid__dot {
          width: 10px;
          height: 10px;
          background-color: var(--light-black);
          border-radius: 50%;
          cursor: pointer;
          transition: background-color 0.3s ease;
          &:hover {
            background-color: var(--white);
          }
        }
        .extinction__grid__dot--active {
          background-color: var(--white);
        }
      }
      .extinction__grid__prev,
      .extinction__grid__next {
        width: 2.8rem;
        height: 2.8rem;
        background-color: rgba(0, 0, 0, 0.4);
        border-radius: 50%;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.5rem;
        transition: background-color 0.3s ease;
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        display: none;
        li {
          color: var(--white);
        }
        &:hover {
          background-color: var(--light-black);
        }
      }
      .extinction__grid__next {
        right: -1rem;
      }
      .extinction__grid__prev {
        left: -1rem;
      }
      .extinction__grid__text {
        padding: 1.5rem;
      }
      .extinction__main {
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 2rem;
      }
    }
    .extinction__footer {
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 500px;
      margin-top: 2rem;
      .extinction__footer__text {
        max-width: 800px;
        background-color: var(--secondary-dark);
        padding: 1.5rem;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        .extinction__footer__img {
          margin: 1.5rem 0;
          img {
            width: 100%;
            max-width: 500px;
            border-radius: 1rem;
          }
        }
      }
      .extinction__footer__img__desktop {
        display: none;
      }
      .extinction__footer__title {
        font-size: 2rem;
        color: var(--white);
      }
      .extinction__footer__desc {
        font-size: 1.1rem;
        color: var(--white);
        max-width: 45ch;
        margin: 0 auto;
        text-align: left;
        span {
          color: var(--white);
          font-weight: bold;
        }
      }
    }
  }
  @media (width > 480px) {
    .extinction {
      .extinction__cont {
        .extinction__title {
          font-size: 2.8rem;
        }
        .extinction__subtitle {
          font-size: 1.8rem;
        }
        .extinction__grid__cont {
          width: 90%;
          margin: 0 auto;
        }
        .extinction__grid__item {
          h4 {
            font-size: 1.8rem;
          }
        }
      }
      .extinction__footer {
        .extinction__footer__text {
          .extinction__footer__img {
            img {
              max-width: 600px;
            }
          }
        }
        .extinction__footer__desc {
          font-size: 1.1rem;
          max-width: 50ch;
        }
      }
    }
  }
  @media (width > 768px) {
    .extinction {
      .extinction__cont {
        .extinction__grid {
          transition: all 0.7s ease;
        }
        .extinction__grid__prev,
        .extinction__grid__next {
          display: flex;
        }
        .extinction__grid__cont {
          width: 95%;
          margin: 0 auto;
        }
        .extinction__footer {
          max-width: fit-content;
          flex-direction: row;
          padding: 2rem;
          background-color: var(--secondary-dark);
          justify-content: center;
          border-radius: 1rem;
          box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
          .extinction__footer__text {
            gap: 1rem;
            text-align: left;
            align-items: flex-start;
            background-color: unset;
            box-shadow: unset;
            .extinction__footer__img {
              display: none;
            }
          }
          .extinction__footer__img__desktop {
            display: block;
            img {
              width: 100%;
              max-width: 400px;
              border-radius: 1rem;
            }
          }
        }
      }
    }
  }
</style>

<script>
  const prevBtn = document.querySelector<HTMLElement>(
    ".extinction__grid__prev"
  )!;
  const nextBtn = document.querySelector<HTMLElement>(
    ".extinction__grid__next"
  )!;
  const grid = document.querySelector<HTMLElement>(".extinction__grid")!;
  const dots = document.querySelectorAll<HTMLElement>(".extinction__grid__dot");
  const items: HTMLElement[] = Array.from(grid.children) as HTMLElement[];
  const totalItems = items.length;
  let currentIndex = 0;
  let itemWidth = 0;

  function updateDots() {
    dots.forEach((dot, index) => {
      if (index === currentIndex) {
        dot.classList.add("extinction__grid__dot--active");
      } else {
        dot.classList.remove("extinction__grid__dot--active");
      }
    });
  }

  function calculateItemWidth() {
    itemWidth = items[0].offsetWidth + 32;
  }

  calculateItemWidth();

  function updateGrid() {
    const offset = currentIndex * itemWidth;
    grid.style.transform = `translateX(-${offset}px)`;
  }

  window.addEventListener("resize", () => {
    calculateItemWidth();
    updateGrid();
  });

  prevBtn.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      updateGrid();
      updateDots();
    } else {
      currentIndex = totalItems - 1;
      updateGrid();
      updateDots();
    }
  });

  nextBtn.addEventListener("click", () => {
    if (currentIndex < totalItems - 1) {
      currentIndex++;
      updateGrid();
      updateDots();
    } else {
      currentIndex = 0;
      updateGrid();
      updateDots();
    }
  });

  dots.forEach((dot, index) => {
    dot.addEventListener("click", () => {
      currentIndex = index;
      updateGrid();
      updateDots();
    });
  });

  let touchStartX = 0;
  let touchEndX = 0;

  grid.addEventListener(
    "touchstart",
    (e) => {
      touchStartX = e.changedTouches[0].clientX;
    },
    { passive: true }
  );

  grid.addEventListener(
    "touchend",
    (e) => {
      touchEndX = e.changedTouches[0].clientX;
      handleSwipe();
    },
    { passive: true }
  );

  function handleSwipe() {
    const swipeDistance = touchEndX - touchStartX;

    if (Math.abs(swipeDistance) > 50) {
      if (swipeDistance < 0) {
        if (currentIndex < totalItems - 1) {
          currentIndex++;
        } else {
          currentIndex = 0;
        }
      } else {
        if (currentIndex > 0) {
          currentIndex--;
        } else {
          currentIndex = totalItems - 1;
        }
      }
      updateGrid();
      updateDots();
    }
  }
</script>
